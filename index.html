<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>åŒ—æµ·é“èœœæœˆæ‰‹å¸³ ğŸ¾ æ——è‰¦å…¨åŠŸèƒ½ç‰ˆ</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        :root { --tea-dark: #D4A373; --tea-mid: #E6D5B8; --tea-light: #F5EBE0; --bg: #FDF8F3; --accent: #000; --white: #FFFFFF; }
        body { background: var(--bg); font-family: "PingFang TC", sans-serif; margin: 0; padding-bottom: 140px; color: #5D5245; min-height: 100vh; background-image: linear-gradient(to bottom, var(--tea-light), var(--bg)); }
        
        /* é£„é›ª */
        .snow-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 99; }
        .snowflake { color: #fff; position: absolute; top: -20px; animation: fall linear infinite; opacity: 0.8; }
        @keyframes fall { 0% { transform: translateY(0) rotate(0deg); } 100% { transform: translateY(100vh) rotate(360deg); } }

        /* æ¨™é¡Œ */
        .header-bar { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); padding: 50px 25px 30px; border-bottom-left-radius: 50px; border-bottom-right-radius: 50px; text-align: center; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .editable-title { border: none; background: transparent; font-size: 24px; font-weight: 900; color: #43382F; text-align: center; width: 100%; outline: none; }
        
        /* å¡ç‰‡ */
        .card { background: var(--white); border-radius: 30px; padding: 20px; margin: 15px; position: relative; border: 1.5px solid var(--tea-mid); box-shadow: 0 10px 30px rgba(93, 82, 69, 0.05); }
        .drag-handle { cursor: grab; padding: 5px 10px; color: var(--tea-mid); font-size: 20px; }
        .img-preview { width: 100%; border-radius: 20px; margin-top: 10px; object-fit: cover; max-height: 300px; display: block; }
        
        /* å°è¦½åˆ— */
        .nav-container { position: fixed; bottom: 30px; left: 20px; right: 20px; z-index: 1000; }
        .nav { background: #1a1a1a; height: 75px; border-radius: 40px; display: flex; justify-content: space-around; align-items: center; box-shadow: 0 15px 40px rgba(0,0,0,0.4); }
        .nav-btn { color: #777; border: none; background: none; flex: 1; text-align: center; font-size: 10px; font-weight: bold; }
        .nav-btn.active { color: #fff; transform: translateY(-5px); transition: 0.3s; }
        .nav-icon { font-size: 22px; display: block; margin-bottom: 2px; }

        /* è¼¸å…¥æ¡† */
        input, textarea, select { width: 100%; padding: 14px; margin-top: 8px; border: 1.5px solid var(--tea-light); border-radius: 18px; box-sizing: border-box; font-size: 16px; color: #5D5245; }
        .btn { background: var(--tea-dark); color: #fff; border: none; padding: 16px; border-radius: 25px; width: 100%; font-weight: 900; margin-top: 15px; }
        
        /* æ©Ÿç¥¨èˆ‡æ¨™ç±¤ */
        .ticket { background: #fff; border-radius: 25px; margin: 15px; display: flex; overflow: hidden; border: 2px solid #000; }
        .ticket-left { background: #000; color: #fff; padding: 20px; min-width: 80px; text-align: center; display: flex; flex-direction: column; justify-content: center; }
        .ticket-right { padding: 20px; flex: 1; position: relative; }
        
        .date-scroller { display: flex; overflow-x: auto; gap: 12px; padding: 20px; scrollbar-width: none; }
        .date-item { flex: 0 0 65px; height: 75px; border-radius: 22px; background: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 1.5px solid var(--tea-mid); }
        .date-item.active { background: var(--tea-dark); color: #fff; transform: scale(1.1); }

        .edit-input { border: 1px solid transparent; background: transparent; width: 100%; padding: 4px; border-radius: 5px; }
        .edit-input:focus { border-color: var(--tea-mid); background: #fff; outline: none; }
    </style>
</head>
<body>
    <div class="snow-container" id="snow"></div>

    <div id="app">
        <div class="header-bar">
            <input class="editable-title" v-model="mainTitle" @change="save">
            <div style="background:#000; color:#fff; padding:4px 15px; border-radius:50px; font-size:12px; display:inline-block; margin-top:10px; font-weight:bold;">ğŸ¾ å€’æ•¸ {{ globalCountdown }} å¤©</div>
        </div>

        <div v-if="tab === 'trip'">
            <div class="date-scroller">
                <div v-for="d in 12" :key="d" class="date-item" :class="{active: day === d}" @click="day = d">
                    <span style="font-size:10px;">D{{ d }}</span>
                    <span style="font-size:16px; font-weight:bold;">{{ getShortDate(d) }}</span>
                </div>
            </div>

            <div class="card">
                <input style="border:none; background:#F0E6D8; text-align:center; font-weight:bold; border-radius:10px;" v-model="dayTitles[day]" placeholder="é€™å¤©çš„ä¸»é¡Œï¼Ÿ" @change="save">
                <input v-model="formTrip.title" placeholder="æ™¯é»åç¨±">
                <div style="display:flex; gap:10px;"><input v-model="formTrip.t1" type="time"><input v-model="formTrip.t2" type="time"></div>
                <textarea v-model="formTrip.note" placeholder="è¡Œç¨‹å‚™å¿˜éŒ„..."></textarea>
                <label style="display:block; background:var(--tea-light); color:var(--tea-dark); padding:12px; text-align:center; border-radius:15px; margin-top:10px; font-weight:bold;">
                    ğŸ“· {{ formTrip.img ? 'æ›´æ›ç…§ç‰‡' : 'ä¸Šå‚³ç…§ç‰‡' }}
                    <input type="file" @change="handleUpload" hidden accept="image/*">
                </label>
                <img v-if="formTrip.img" :src="formTrip.img" class="img-preview">
                <button class="btn" @click="addTrip">åŠ å…¥è¡Œç¨‹ ğŸ¾</button>
            </div>

            <div id="trip-list">
                <div v-for="t in filteredTrips" :key="t.id" class="card" :data-id="t.id">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                        <div class="drag-handle">â ¿</div>
                        <div style="flex:1; margin-left:10px; display:flex; gap:5px;">
                            <input class="edit-input" style="font-size:12px; font-weight:bold; color:var(--tea-dark); width:70px;" v-model="t.t1" @change="save" type="time">
                            <span style="font-size:12px; color:#ccc;">-</span>
                            <input class="edit-input" style="font-size:12px; font-weight:bold; color:var(--tea-dark); width:70px;" v-model="t.t2" @change="save" type="time">
                        </div>
                        <div @click="removeTrip(t.id)" style="color:#eee; padding:5px;">âœ•</div>
                    </div>
                    <input class="edit-input" style="font-size:19px; font-weight:900;" v-model="t.title" @change="save">
                    <textarea class="edit-input" style="font-size:14px; color:#666; margin-top:5px; line-height:1.5;" v-model="t.note" @change="save" rows="2"></textarea>
                    <img v-if="t.img" :src="t.img" class="img-preview">
                </div>
            </div>
        </div>

        <div v-if="tab === 'book'">
            <div style="display:flex; gap:12px; margin:20px;">
                <button @click="sub='t'" :style="sub==='t'?'background:#000;color:#fff':'background:#fff'" style="flex:1; border-radius:20px; border:none; padding:14px; font-weight:bold; box-shadow:0 4px 10px rgba(0,0,0,0.05);">âœˆï¸ äº¤é€š</button>
                <button @click="sub='s'" :style="sub==='s'?'background:#000;color:#fff':'background:#fff'" style="flex:1; border-radius:20px; border:none; padding:14px; font-weight:bold; box-shadow:0 4px 10px rgba(0,0,0,0.05);">ğŸ¨ ä½å®¿</button>
            </div>
            <div class="card">
                <input v-model="formBook.title" :placeholder="sub==='t'?'èˆªç­è™Ÿ':'é£¯åº—åç¨±'">
                <input v-model="formBook.info" :placeholder="sub==='t'?'èˆªæ®µ (å¦‚: TPE-CTS)':'åœ°å€æˆ–åœ°åœ–é€£çµ'">
                <button class="btn" @click="addBook" style="background:#000;">å„²å­˜ ğŸ¾</button>
            </div>
            <template v-if="sub === 't'">
                <div v-for="(b, i) in books.t" :key="i" class="ticket">
                    <div class="ticket-left"><div style="font-size:10px; opacity:0.7;">FLIGHT</div><div style="font-size:16px; font-weight:bold;">{{ b.title }}</div></div>
                    <div class="ticket-right"><div @click="removeBook(i)" style="position:absolute; right:15px; color:#ccc;">âœ•</div><div style="font-weight:bold;">{{ b.info }}</div></div>
                </div>
            </template>
            <template v-else>
                <div v-for="(b, i) in books.s" :key="i" class="card">
                    <div @click="removeBook(i)" style="position:absolute; right:20px; color:#eee;">âœ•</div>
                    <div style="font-weight:bold; font-size:18px;">{{ b.title }}</div>
                    <div style="font-size:14px; color:#888; margin-top:5px;">ğŸ“ {{ b.info }}</div>
                    <a :href="'http://googleusercontent.com/maps.google.com/3' + encodeURIComponent(b.title + ' ' + b.info)" target="_blank" style="text-decoration:none; display:inline-block; margin-top:10px; color:var(--tea-dark); font-weight:bold; font-size:12px;">ğŸ—ºï¸ Google åœ°åœ–å°è¦½</a>
                </div>
            </template>
        </div>

        <div v-if="tab === 'list'">
            <div class="card"><input v-model="newItem" placeholder="æƒ³è¦æº–å‚™ä»€éº¼ï¼Ÿ" @keyup.enter="addItem"><button class="btn" @click="addItem">ï¼‹ åŠ å…¥è¡Œæ</button></div>
            <div class="card">
                <div v-for="(item, i) in list" :key="i" style="display:flex; align-items:center; padding:15px 0; border-bottom:1px solid var(--tea-light);">
                    <input type="checkbox" v-model="item.done" @change="save" style="width:20px; height:20px; margin-right:15px;">
                    <span :style="item.done?'text-decoration:line-through; color:#ccc':''" style="flex:1; font-weight:bold;">{{ item.text }}</span>
                    <span @click="removeItem(i)" style="color:#eee;">âœ•</span>
                </div>
            </div>
        </div>

        <div v-if="tab === 'money'">
            <div style="background:#43382F; color:#fff; border-radius:40px; padding:35px 20px; margin:15px; text-align:center;">
                <div style="font-size:12px; opacity:0.6;">TOTAL SPENT</div>
                <div style="font-size:36px; font-weight:bold; margin:5px 0;">Â¥ {{ total.toLocaleString() }}</div>
                <div style="color:var(--tea-mid);">NT$ {{ Math.round(total * 0.21).toLocaleString() }}</div>
            </div>
            <div class="card">
                <select v-model="formExp.cat"><option v-for="c in categories" :value="c.n">{{c.i}} {{c.n}}</option></select>
                <input v-model.number="formExp.amt" type="number" placeholder="æ—¥å¹£é‡‘é¡ (JPY)">
                <input v-model="formExp.note" placeholder="æ¶ˆè²»å…§å®¹">
                <button class="btn" @click="addExp">ç´€éŒ„é€™ç­†æ”¯å‡º ğŸª™</button>
            </div>
            <div v-for="(e, i) in exps" :key="i" class="card" style="display:flex; align-items:center; padding:15px;">
                <span style="font-size:10px; background:var(--tea-light); color:var(--tea-dark); padding:4px 8px; border-radius:10px; margin-right:10px;">{{ e.cat }}</span>
                <span style="flex:1; font-weight:bold;">{{ e.note || 'æ”¯å‡º' }}</span>
                <span style="font-weight:900;">Â¥ {{ e.amt }}</span>
                <span @click="removeExp(i)" style="margin-left:15px; color:#eee;">âœ•</span>
            </div>
        </div>

        <div class="nav-container">
            <nav class="nav">
                <button class="nav-btn" :class="{active: tab==='trip'}" @click="tab='trip'"><span class="nav-icon">ğŸ—“ï¸</span>è¡Œç¨‹</button>
                <button class="nav-btn" :class="{active: tab==='book'}" @click="tab='book'"><span class="nav-icon">ğŸ”–</span>é è¨‚</button>
                <button class="nav-btn" :class="{active: tab==='list'}" @click="tab='list'"><span class="nav-icon">ğŸ’</span>è¡Œæ</button>
                <button class="nav-btn" :class="{active: tab==='money'}" @click="tab='money'"><span class="nav-icon">ğŸª™</span>è¨˜å¸³</button>
            </nav>
        </div>
    </div>

    <script>
        const { createApp } = Vue
        createApp({
            data() {
                return {
                    tab: 'trip', day: 1, sub: 't', start: '2026-01-12',
                    mainTitle: localStorage.getItem('hk_title') || 'åŒ—æµ·é“ â„ï¸ èœœæœˆæ‰‹å¸³',
                    dayTitles: JSON.parse(localStorage.getItem('hk_day_titles') || '{}'),
                    formTrip: { title: '', t1: '09:00', t2: '10:00', note: '', img: null },
                    formBook: { title: '', info: '' },
                    formExp: { amt: null, note: '', cat: 'åƒå–' },
                    newItem: '',
                    categories: [{n:'åƒå–',i:'ğŸ±'},{n:'äº¤é€š',i:'ğŸš„'},{n:'è³¼ç‰©',i:'ğŸ›ï¸'},{n:'æ™¯é»',i:'ğŸ¡'},{n:'å…¶ä»–',i:'âœ¨'}],
                    trips: JSON.parse(localStorage.getItem('hk_v9_t') || '[]'),
                    books: JSON.parse(localStorage.getItem('hk_v9_b') || '{"t":[],"s":[]}'),
                    list: JSON.parse(localStorage.getItem('hk_v9_l') || '[{"text":"è­·ç…§","done":false}]'),
                    exps: JSON.parse(localStorage.getItem('hk_v9_m') || '[]')
                }
            },
            computed: {
                globalCountdown() { return Math.max(0, Math.ceil((new Date(this.start) - new Date()) / 86400000)); },
                filteredTrips() { 
                    return this.trips.filter(t => t.day === this.day).sort((a,b) => (a.order || 0) - (b.order || 0));
                },
                total() { return this.exps.reduce((s, e) => s + (e.amt || 0), 0); }
            },
            mounted() { this.initSortable(); this.createSnow(); },
            updated() { this.initSortable(); },
            methods: {
                getShortDate(d) { const dt = new Date(this.start); dt.setDate(dt.getDate() + (d-1)); return (dt.getMonth()+1)+'/'+dt.getDate(); },
                handleUpload(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onload = (ev) => { this.formTrip.img = ev.target.result; };
                    reader.readAsDataURL(file);
                },
                addTrip() {
                    if(!this.formTrip.title) return;
                    this.trips.push({ id: Date.now().toString(), day: this.day, order: this.trips.length, ...this.formTrip });
                    this.save();
                    this.formTrip = { title: '', t1: '09:00', t2: '10:00', note: '', img: null };
                },
                removeTrip(id) { this.trips = this.trips.filter(t => t.id !== id); this.save(); },
                addBook() { if(!this.formBook.title) return; this.books[this.sub].push({...this.formBook}); this.save(); this.formBook = { title: '', info: '' }; },
                removeBook(i) { this.books[this.sub].splice(i, 1); this.save(); },
                addItem() { if(this.newItem){ this.list.push({text:this.newItem,done:false}); this.save(); this.newItem=''; } },
                removeItem(i) { this.list.splice(i, 1); this.save(); },
                addExp() { if(this.formExp.amt){ this.exps.unshift({...this.formExp}); this.save(); this.formExp.amt=null; this.formExp.note=''; } },
                removeExp(i) { this.exps.splice(i, 1); this.save(); },
                save() {
                    localStorage.setItem('hk_title', this.mainTitle);
                    localStorage.setItem('hk_day_titles', JSON.stringify(this.dayTitles));
                    localStorage.setItem('hk_v9_t', JSON.stringify(this.trips));
                    localStorage.setItem('hk_v9_b', JSON.stringify(this.books));
                    localStorage.setItem('hk_v9_l', JSON.stringify(this.list));
                    localStorage.setItem('hk_v9_m', JSON.stringify(this.exps));
                },
                createSnow() {
                    const container = document.getElementById('snow');
                    for(let i=0; i<15; i++) {
                        let s = document.createElement('div');
                        s.className = 'snowflake'; s.innerHTML = 'â„';
                        s.style.left = Math.random() * 100 + 'vw';
                        s.style.animationDuration = (Math.random() * 3 + 4) + 's';
                        s.style.opacity = Math.random();
                        container.appendChild(s);
                    }
                },
                initSortable() {
                    const el = document.getElementById('trip-list');
                    if (!el) return;
                    if (this.sortableInstance) this.sortableInstance.destroy();
                    this.sortableInstance = Sortable.create(el, {
                        handle: '.drag-handle', animation: 150,
                        onEnd: () => {
                            const ids = Array.from(el.children).map(c => c.dataset.id);
                            this.trips.forEach(t => { if(t.day === this.day) t.order = ids.indexOf(t.id); });
                            this.save();
                        }
                    });
                }
            }
        }).mount('#app')
    </script>
</body>
</html>
