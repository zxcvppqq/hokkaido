<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>åŒ—æµ·é“èœœæœˆæ‰‹å¸³ â„ï¸ æ™¯é»å°ˆå±¬å‚™å¿˜ç‰ˆ</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <style>
        :root { 
            --bg: #F8F8F8; 
            --tapir-black: #222222; 
            --heart-pink: #FFC0CB;
            --memo-yellow: #FFF9C4;
        }
        
        body { 
            background: var(--bg); 
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif; 
            margin: 0; padding: 10px 15px 120px 15px; color: var(--tapir-black); 
        }

        /* å€’æ•¸è¨ˆæ™‚ */
        .countdown-bar { background: var(--tapir-black); color: #fff; padding: 8px; border-radius: 12px; text-align: center; font-size: 12px; margin-bottom: 10px; }
        .countdown-days { color: var(--heart-pink); font-size: 16px; font-weight: bold; }

        /* å·¥å…·åˆ— */
        .top-tools { display: flex; gap: 8px; margin-bottom: 15px; align-items: center; }
        .day-dropdown-container { flex: 1; background: #fff; padding: 10px; border-radius: 15px; border: 2px solid #000; box-shadow: 2px 2px 0px #DDD; }
        .day-select { width: 100%; border: none; font-size: 14px; font-weight: bold; outline: none; background: transparent; }
        .icon-btn { background: #fff; border: 2px solid #000; padding: 8px 12px; border-radius: 15px; font-size: 18px; box-shadow: 2px 2px 0px #DDD; cursor: pointer; }

        /* äº¤é€šåœ°åœ–å½ˆçª— */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.85); z-index: 2000; padding: 20px; display: flex; flex-direction: column; }
        .modal-content { background: #fff; border-radius: 15px; flex: 1; overflow: auto; padding: 10px; }
        .map-img { width: 100%; display: block; }
        .close-modal { color: #fff; text-align: right; padding: 10px; font-size: 18px; }

        /* å¡ç‰‡ */
        .card { background: #fff; border-radius: 20px; padding: 18px; margin-bottom: 15px; border: 2px solid #000; box-shadow: 4px 4px 0px #DDD; position: relative; }
        .card-title { font-weight: bold; font-size: 16px; margin-bottom: 10px; border-left: 5px solid #000; padding-left: 10px; }

        /* è¡¨å–® */
        input, select, textarea { width: 100%; padding: 12px; margin-top: 8px; border: 1px solid #CCC; border-radius: 10px; box-sizing: border-box; font-size: 14px; font-family: inherit; }
        .btn { background: #000; color: #fff; border: none; padding: 14px; border-radius: 12px; width: 100%; font-weight: bold; margin-top: 10px; }

        /* è¡Œç¨‹å¡ç‰‡ç´°ç¯€ */
        .duration-tag { background: var(--heart-pink); color: #000; font-size: 10px; padding: 2px 6px; border-radius: 6px; font-weight: bold; margin-left: 8px; }
        .item-memo { background: var(--memo-yellow); padding: 10px; border-radius: 10px; margin-top: 10px; font-size: 13px; color: #444; line-height: 1.5; border: 1px dashed #E6D978; }
        .map-tag { display: inline-block; background: #f0f0f0; padding: 5px 12px; border-radius: 8px; font-size: 12px; text-decoration: none; color: #333; margin-top: 10px; border: 1px solid #000; font-weight: bold; }
        .delete-btn { color: #ff6b6b; font-size: 14px; position: absolute; top: 18px; right: 18px; cursor: pointer; }

        /* å°è¦½åˆ— */
        .nav-bar { position: fixed; bottom: 15px; left: 15px; right: 15px; height: 60px; background: #000; border-radius: 30px; display: flex; justify-content: space-around; align-items: center; z-index: 1000; }
        .nav-item { color: #666; border: none; background: none; text-align: center; flex: 1; outline: none; }
        .nav-item.active { color: var(--heart-pink); }
        .nav-text { font-size: 9px; margin-top: 2px; display: block; }
    </style>
</head>
<body>
    <div id="app">
        <div class="countdown-bar">
            ğŸ¦¨ è·é›¢åŒ—æµ·é“èœœæœˆå‡ºç™¼é‚„æœ‰ <span class="countdown-days">{{ countdown }}</span> å¤©
        </div>

        <div v-if="showMapModal" class="modal-overlay">
            <div class="close-modal" @click="showMapModal = false">âœ• é»æ“Šé—œé–‰</div>
            <div style="display:flex; gap:5px; margin-bottom:10px;">
                <button @click="mapType = 'jr'" :style="mapType === 'jr' ? 'background:#000;color:#fff' : 'background:#fff'" style="flex:1;padding:8px;border-radius:8px;font-size:12px;">JR åŒ—æµ·é“</button>
                <button @click="mapType = 'subway'" :style="mapType === 'subway' ? 'background:#000;color:#fff' : 'background:#fff'" style="flex:1;padding:8px;border-radius:8px;font-size:12px;">æœ­å¹Œåœ°éµ</button>
            </div>
            <div class="modal-content">
                <img v-if="mapType === 'jr'" src="https://www.jrhokkaido.co.jp/global/chinese/ttable/pdf/route_map.pdf.jpg" class="map-img">
                <img v-if="mapType === 'subway'" src="https://www.city.sapporo.jp/st/subway/route_map/images/route_map_color.png" class="map-img">
            </div>
        </div>

        <div v-if="activeTab === 'trip'">
            <div class="top-tools">
                <div class="day-dropdown-container">
                    <select v-model="currentDay" class="day-select">
                        <option v-for="d in 12" :key="d" :value="d">Day {{ d }} è¡Œç¨‹è¦åŠƒ</option>
                    </select>
                </div>
                <button class="icon-btn" @click="showMapModal = true">ğŸ—ºï¸</button>
                <a href="https://www.jma.go.jp/bosai/wdist/#lat:43.06&lon:141.35&zoom:9" target="_blank" class="icon-btn">ğŸŒ¡ï¸</a>
            </div>

            <div class="card">
                <div class="card-title">æ–°å¢ Day {{currentDay}} æ™¯é»</div>
                <div style="display:flex; gap:10px;">
                    <input v-model="newTrip.startTime" type="time">
                    <input v-model="newTrip.endTime" type="time">
                </div>
                <input v-model="newTrip.desc" placeholder="åœ°é»åç¨± (å¦‚ï¼šæ—­å±±å‹•ç‰©åœ’)">
                <textarea v-model="newTrip.note" placeholder="åœ°é»å‚™å¿˜éŒ„ (å¦‚ï¼šåˆé¤åƒé–€å£æ‹‰éºµã€è²·ä¼éµåŠé£¾)" rows="2"></textarea>
                <button class="btn" @click="addTrip">åŠ å…¥ä»Šæ—¥è¡Œç¨‹</button>
            </div>

            <div v-for="item in filteredTrips" :key="item.id" class="card">
                <span class="delete-btn" @click="removeTrip(item.id)">âœ•</span>
                <div style="display:flex; align-items:center;">
                    <span style="font-size: 13px; font-weight: bold; color: #888;">âŒš {{ item.startTime }} - {{ item.endTime }}</span>
                    <span v-if="calculateDuration(item.startTime, item.endTime)" class="duration-tag">{{ calculateDuration(item.startTime, item.endTime) }}</span>
                </div>
                <div style="font-size: 18px; font-weight: bold; margin: 6px 0;">{{ item.desc }}</div>
                
                <div v-if="item.note" class="item-memo">
                    <div style="font-weight:bold; font-size:11px; margin-bottom:4px; opacity:0.6;">MEMO å‚™å¿˜éŒ„ï¼š</div>
                    {{ item.note }}
                </div>
                
                <a :href="'https://www.google.com/maps/search/?api=1&query=' + encodeURIComponent(item.desc)" target="_blank" class="map-tag">ğŸ“ å°èˆªåˆ°æ­¤</a>
            </div>
        </div>

        <div v-if="activeTab === 'book'">
            <div class="card">
                <div class="card-title">å¿«é€Ÿç´€éŒ„é è¨‚</div>
                <input v-model="newBook.type" placeholder="é …ç›® (å¦‚: é£¯åº—/äº¤é€šåˆ¸)">
                <input v-model="newBook.info" placeholder="è©³ç´°å…§å®¹/é£¯åº—åç¨±">
                <input v-model="newBook.time" placeholder="æ™‚é–“/ç¢ºèªç¢¼">
                <button class="btn" @click="addBook">å„²å­˜</button>
            </div>
            <div v-for="(item, index) in books" :key="index" class="card">
                <span class="delete-btn" @click="removeBook(index)">âœ•</span>
                <div style="background:#000; color:#fff; display:inline-block; padding:2px 8px; border-radius:4px; font-size:11px; margin-bottom:8px;">{{ item.type }}</div>
                <div style="font-size: 17px; font-weight: bold;">{{ item.info }}</div>
                <div style="font-size: 13px; color: #666; margin-top:4px;">ğŸ“‹ {{ item.time }}</div>
            </div>
        </div>

        <div v-if="activeTab === 'list'">
            <div class="card">
                <div class="card-title">è¡Œææª¢æŸ¥ â„ï¸</div>
                <div style="display:flex; gap:10px;"><input v-model="newItem" placeholder="è¦å¸¶çš„æ±è¥¿..." style="margin:0;"><button class="btn" @click="addItem" style="margin:0; width:60px;">+</button></div>
            </div>
            <div class="card">
                <div v-for="(item, index) in checklist" :key="index" @click="toggleItem(index)" style="display:flex; align-items:center; padding:10px 0; border-bottom:1px dashed #EEE;">
                    <div :style="{width:'20px', height:'20px', border:'2px solid #000', marginRight:'10px', display:'flex', justifyContent:'center', alignItems:'center', background: item.done ? '#000' : 'none', color: '#FFC0CB'}">{{ item.done ? 'âœ“' : '' }}</div>
                    <span :style="{textDecoration: item.done ? 'line-through' : 'none', color: item.done ? '#AAA' : '#000'}">{{ item.text }}</span>
                    <span @click.stop="removeItem(index)" style="margin-left:auto; color:#CCC;">âœ•</span>
                </div>
            </div>
        </div>

        <div v-if="activeTab === 'money'">
            <div class="card" style="background:#000; color:#fff; text-align:center;">
                <div style="font-size:30px; font-weight:bold;">Â¥ {{ totalSpent }}</div>
                <div style="font-size:12px; background:var(--heart-pink); color:black; display:inline-block; padding:2px 10px; border-radius:10px; font-weight:bold; margin-top:5px;">ç´„ NT$ {{ Math.round(totalSpent * 0.21) }}</div>
            </div>
            <div class="card"><input v-model.number="newExp.amount" type="number" placeholder="æ—¥å¹£é‡‘é¡"><input v-model="newExp.note" placeholder="é …ç›®"><button class="btn" @click="addExp">ç´€éŒ„</button></div>
            <div v-for="(exp, index) in expenses" :key="index" class="card" style="display:flex; justify-content:space-between; align-items:center;">
                <span>ğŸ–¤ {{ exp.note }}</span><b>Â¥ {{ exp.amount }}</b><span @click="removeExp(index)" style="color:#CCC;">âœ•</span>
            </div>
        </div>

        <div v-if="activeTab === 'member'">
            <div class="card"><div class="card-title">å‡ºç™¼æ—¥æœŸ</div><input v-model="startDate" type="date"></div>
            <div v-for="role in ['girl', 'boy']" :key="role" class="card" style="display:flex; align-items:center; gap:12px;">
                <div style="width:50px; height:50px; border-radius:50%; border:2px solid #000; overflow:hidden;"><img :src="members[role].img" style="width:100%; height:100%; object-fit:cover;"></div>
                <div style="flex:1;"><input v-model="members[role].name"><input v-model="members[role].note" style="margin-top:4px;"></div>
            </div>
            <button class="btn" @click="saveMembers">ğŸ’¾ å„²å­˜ä¿®æ”¹</button>
        </div>

        <nav class="nav-bar">
            <button v-for="tab in [{k:'trip',i:'ğŸ—“ï¸',t:'è¡Œç¨‹'},{k:'book',i:'ğŸ«',t:'é è¨‚'},{k:'list',i:'âœ…',t:'æ¸…å–®'},{k:'money',i:'ğŸª™',t:'è¨˜å¸³'},{k:'member',i:'ğŸ‘¥',t:'æˆ‘å€‘'}]" 
                    :key="tab.k" class="nav-item" :class="{active: activeTab === tab.k}" @click="activeTab = tab.k">
                <span style="font-size:18px;">{{ tab.i }}</span><span class="nav-text">{{ tab.t }}</span>
            </button>
        </nav>
    </div>

    <script>
        const { createApp } = Vue
        createApp({
            data() {
                return {
                    activeTab: 'trip', currentDay: 1, showMapModal: false, mapType: 'jr',
                    newTrip: { startTime: '', endTime: '', desc: '', note: '' },
                    newExp: { amount: null, note: '' }, newBook: { type: '', info: '', time: '' }, newItem: '',
                    startDate: localStorage.getItem('h_start_v14') || '2025-01-01',
                    members: JSON.parse(localStorage.getItem('h_members_v14')) || {
                        girl: { name: 'å¥³ä¸»è§’ ğŸ’–', note: 'åŒ—æµ·é“ç¾é£Ÿç‰¹æ´¾å“¡', img: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Aneka' },
                        boy: { name: 'ç”·ä¸»è§’ ğŸ¦¨', note: 'æœ€å¼·å°èˆªèˆ‡æ”å½±', img: 'https://api.dicebear.com/7.x/avataaars/svg?seed=Felix' }
                    },
                    trips: JSON.parse(localStorage.getItem('h_trips_v14') || '[]'),
                    expenses: JSON.parse(localStorage.getItem('h_money_v14') || '[]'),
                    books: JSON.parse(localStorage.getItem('h_books_v14') || '[]'),
                    checklist: JSON.parse(localStorage.getItem('h_list_v14') || '[]')
                }
            },
            computed: {
                countdown() {
                    const diff = new Date(this.startDate) - new Date();
                    return Math.ceil(diff / (1000 * 60 * 60 * 24)) > 0 ? Math.ceil(diff / (1000 * 60 * 60 * 24)) : 0;
                },
                filteredTrips() { return this.trips.filter(t => t.day === parseInt(this.currentDay)).sort((a,b) => a.startTime.localeCompare(b.startTime)); },
                totalSpent() { return this.expenses.reduce((sum, item) => sum + (item.amount || 0), 0); }
            },
            methods: {
                calculateDuration(start, end) {
                    if (!start || !end) return null;
                    const s = start.split(':'); const e = end.split(':');
                    let diff = (parseInt(e[0]) * 60 + parseInt(e[1])) - (parseInt(s[0]) * 60 + parseInt(s[1]));
                    if (diff < 0) diff += 1440;
                    const h = Math.floor(diff / 60); const m = diff % 60;
                    return h > 0 ? `${h}h ${m > 0 ? m+'m' : ''}` : `${m}m`;
                },
                addTrip() { if(this.newTrip.desc && this.newTrip.startTime){ this.trips.push({ id: Date.now(), day: parseInt(this.currentDay), ...this.newTrip }); this.save(); this.newTrip = { startTime: '', endTime: '', desc: '', note: '' }; } },
                removeTrip(id) { this.trips = this.trips.filter(t => t.id !== id); this.save(); },
                addExp() { if(this.newExp.amount){ this.expenses.push({...this.newExp}); this.save(); this.newExp = { amount: null, note: '' }; } },
                removeExp(i) { this.expenses.splice(i, 1); this.save(); },
                addBook() { if(this.newBook.info){ this.books.push({...this.newBook}); this.save(); this.newBook = { type: '', info: '', time: '' }; } },
                removeBook(i) { this.books.splice(i, 1); this.save(); },
                addItem() { if(this.newItem){ this.checklist.push({ text: this.newItem, done: false }); this.save(); this.newItem = ''; } },
                toggleItem(i) { this.checklist[i].done = !this.checklist[i].done; this.save(); },
                removeItem(i) { this.checklist.splice(i, 1); this.save(); },
                saveMembers() { localStorage.setItem('h_members_v14', JSON.stringify(this.members)); localStorage.setItem('h_start_v14', this.startDate); alert('è¨­å®šå·²å„²å­˜ï¼'); },
                save() {
                    localStorage.setItem('h_trips_v14', JSON.stringify(this.trips));
                    localStorage.setItem('h_money_v14', JSON.stringify(this.expenses));
                    localStorage.setItem('h_books_v14', JSON.stringify(this.books));
                    localStorage.setItem('h_list_v14', JSON.stringify(this.checklist));
                }
            }
        }).mount('#app')
    </script>
</body>
</html>
