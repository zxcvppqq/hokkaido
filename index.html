<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Honeymoon Hokkaido 2026 â„ï¸</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        :root { --tea-dark: #D4A373; --tea-mid: #E6D5B8; --tea-light: #F5EBE0; --bg: #FDF8F3; --accent: #ff8fa3; --white: #FFFFFF; }
        body { background: var(--bg); font-family: "PingFang TC", sans-serif; margin: 0; padding-bottom: 140px; color: #5D5245; min-height: 100vh; overflow-x: hidden; }
        
        .snow-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 99; }
        .snowflake { color: #fff; position: absolute; top: -20px; animation: fall linear infinite; opacity: 0.8; }
        @keyframes fall { 0% { transform: translateY(0) rotate(0deg); } 100% { transform: translateY(100vh) rotate(360deg); } }

        /* é ‚éƒ¨èœœæœˆé€²åº¦ */
        .header-bar { background: rgba(255, 255, 255, 0.85); backdrop-filter: blur(15px); padding: 45px 25px 25px; border-bottom-left-radius: 40px; border-bottom-right-radius: 40px; text-align: center; border-bottom: 1px solid var(--tea-mid); }
        .editable-title { border: none; background: transparent; font-size: 22px; font-weight: 900; color: #43382F; text-align: center; width: 100%; outline: none; }
        .progress-box { background: var(--tea-light); height: 6px; border-radius: 10px; margin: 15px 40px 5px; overflow: hidden; }
        .progress-fill { background: var(--accent); height: 100%; transition: width 0.5s; }

        .card { background: var(--white); border-radius: 25px; padding: 20px; margin: 15px; border: 1px solid var(--tea-mid); position: relative; box-shadow: 0 8px 20px rgba(0,0,0,0.02); }
        .photo-frame { background: #fff; padding: 10px 10px 25px; border: 1px solid #eee; box-shadow: 0 5px 15px rgba(0,0,0,0.05); transform: rotate(-1deg); margin-top: 15px; }
        .img-preview { width: 100%; border-radius: 4px; object-fit: cover; max-height: 350px; display: block; }
        
        /* ğŸ« äº¤é€šæ¨™ç±¤ */
        .boarding-pass { background: #fff; border-radius: 20px; margin: 15px; display: flex; border: 2px solid #333; overflow: hidden; box-shadow: 4px 4px 0 var(--tea-mid); }
        .pass-left { background: #333; color: #fff; width: 80px; padding: 15px; text-align: center; display: flex; flex-direction: column; justify-content: center; border-right: 2px dashed #555; }
        .pass-right { flex: 1; padding: 15px; position: relative; }
        
        .nav-container { position: fixed; bottom: 25px; left: 20px; right: 20px; z-index: 1000; }
        .nav { background: #222; height: 70px; border-radius: 35px; display: flex; justify-content: space-around; align-items: center; }
        .nav-btn { color: #888; border: none; background: none; flex: 1; text-align: center; font-size: 10px; font-weight: bold; }
        .nav-btn.active { color: var(--accent); transform: translateY(-3px); transition: 0.3s; }
        .nav-icon { font-size: 20px; display: block; margin-bottom: 2px; }

        input, textarea, select { width: 100%; padding: 12px 16px; margin-top: 8px; border: 1.5px solid var(--tea-light); border-radius: 15px; box-sizing: border-box; font-size: 16px; outline: none; }
        .btn { background: var(--tea-dark); color: #fff; border: none; padding: 15px; border-radius: 20px; width: 100%; font-weight: bold; margin-top: 10px; }
        
        .date-scroller { display: flex; overflow-x: auto; gap: 10px; padding: 15px 20px; scrollbar-width: none; }
        .date-item { flex: 0 0 58px; height: 65px; border-radius: 18px; background: #fff; display: flex; flex-direction: column; align-items: center; justify-content: center; border: 1.5px solid var(--tea-mid); }
        .date-item.active { background: var(--tea-dark); color: #fff; }

        .edit-input { border: 1px solid transparent; background: transparent; width: 100%; padding: 4px; border-radius: 5px; font-family: inherit; }
        .edit-input:focus { background: #fff; border-color: var(--tea-mid); outline: none; }
        .del-btn { color: #eee; font-size: 18px; cursor: pointer; padding: 5px; }
        .del-btn:hover { color: var(--accent); }
    </style>
</head>
<body>
    <div class="snow-container" id="snow"></div>

    <div id="app">
        <div class="header-bar">
            <input class="editable-title" v-model="mainTitle" @change="save">
            <div class="progress-box"><div class="progress-fill" :style="{ width: tripProgress + '%' }"></div></div>
            <div style="font-size: 11px; color: #aaa; font-weight: bold;">â„ï¸ HOKKAIDO HONEYMOON Â· D{{day}} â„ï¸</div>
        </div>

        <div v-if="tab === 'trip'">
            <div class="date-scroller">
                <div v-for="d in 12" :key="d" class="date-item" :class="{active: day === d}" @click="day = d">
                    <span style="font-size:10px;">Day</span><span style="font-size:16px; font-weight:900;">{{ d }}</span>
                </div>
            </div>
            <div class="card">
                <input style="border:none; background:#FFF5F5; text-align:center; font-weight:bold; border-radius:10px; color:var(--accent);" v-model="dayTitles[day]" placeholder="é€™å¤©çš„ç”œèœœä¸»é¡Œï¼Ÿ" @change="save">
                <input v-model="formTrip.title" placeholder="ç›®çš„åœ°åç¨±">
                <div style="display:flex; gap:8px;"><input v-model="formTrip.t1" type="time"><input v-model="formTrip.note" placeholder="å°å‚™è¨»..."></div>
                <label style="display:block; background:var(--tea-light); color:var(--tea-dark); padding:12px; text-align:center; border-radius:15px; margin-top:10px; font-weight:bold; cursor:pointer;">
                    ğŸ“· åŠ å…¥åˆç…§ <input type="file" @change="handleUpload" hidden accept="image/*">
                </label>
                <div v-if="formTrip.img" class="photo-frame"><img :src="formTrip.img" class="img-preview"></div>
                <button class="btn" @click="addTrip" style="background:var(--accent);">æ–°å¢è¡Œç¨‹ âœ¨</button>
            </div>
            <div id="trip-list">
                <div v-for="t in filteredTrips" :key="t.id" class="card" :data-id="t.id">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <div class="drag-handle" style="cursor:grab; color:#ccc;">â ¿</div>
                        <input class="edit-input" style="font-size:13px; font-weight:bold; color:var(--tea-dark); width:70px;" v-model="t.t1" @change="save">
                        <div class="del-btn" @click="removeTrip(t.id)">âœ•</div>
                    </div>
                    <input class="edit-input" style="font-size:20px; font-weight:900;" v-model="t.title" @change="save">
                    <input class="edit-input" style="font-size:14px; color:#777;" v-model="t.note" @change="save" placeholder="å¯«é»å‚™è¨»...">
                    <a :href="'http://googleusercontent.com/maps.google.com/9' + encodeURIComponent(t.title)" target="_blank" style="display:inline-block; background:#f0f0f0; color:#666; font-size:11px; padding:4px 8px; border-radius:8px; margin-top:8px; text-decoration:none; font-weight:bold;">ğŸ“ åœ°åœ–å°èˆª</a>
                    <div v-if="t.img" class="photo-frame"><img :src="t.img" class="img-preview"></div>
                </div>
            </div>
        </div>

        <div v-if="tab === 'book'">
            <div style="display:flex; gap:10px; margin:15px;">
                <button @click="sub='t'" :style="sub==='t'?'background:#333;color:#fff':'background:#fff'" style="flex:1; border-radius:15px; border:none; padding:15px; font-weight:bold;">âœˆï¸ èˆªç­</button>
                <button @click="sub='s'" :style="sub==='s'?'background:#333;color:#fff':'background:#fff'" style="flex:1; border-radius:15px; border:none; padding:15px; font-weight:bold;">ğŸ¨ ä½å®¿</button>
            </div>
            <div class="card">
                <input v-model="formBook.title" placeholder="åç¨±">
                <input v-model="formBook.info" placeholder="ç·¨è™Ÿ/è©³ç´°è³‡è¨Š">
                <button class="btn" @click="addBook" style="background:#333;">å„²å­˜</button>
            </div>
            <template v-if="sub === 't'">
                <div v-for="(b, i) in books.t" :key="i" class="boarding-pass">
                    <div class="pass-left"><div style="font-size:9px;">FLIGHT</div><div style="font-weight:900;">{{ b.title }}</div></div>
                    <div class="pass-right">
                        <div @click="removeBook(i)" style="position:absolute; right:12px; top:10px; color:#ddd;">âœ•</div>
                        <div style="font-size:20px; font-weight:900;">{{ b.info }}</div>
                    </div>
                </div>
            </template>
            <template v-else>
                <div v-for="(b, i) in books.s" :key="i" class="card">
                    <div @click="removeBook(i)" style="position:absolute; right:20px; top:20px; color:#eee;">âœ•</div>
                    <div style="font-weight:900; font-size:18px;">{{ b.title }}</div>
                    <div style="font-size:14px; color:#888;">ğŸ“ {{ b.info }}</div>
                </div>
            </template>
        </div>

        <div v-if="tab === 'list'">
            <div class="card">
                <input v-model="newItem" placeholder="æº–å‚™ä»€éº¼ç‰©å“ï¼Ÿ" @keyup.enter="addItem">
                <button class="btn" @click="addItem">ï¼‹ åŠ å…¥æ¸…å–®</button>
            </div>
            <div class="card" v-if="list.length">
                <div v-for="(item, i) in list" :key="i" style="display:flex; align-items:center; padding:12px 0; border-bottom:1px solid var(--tea-light);">
                    <input type="checkbox" v-model="item.done" @change="save" style="width:22px; height:22px; margin-right:12px;">
                    <input class="edit-input" :style="item.done?'text-decoration:line-through; color:#ccc':''" v-model="item.text" @change="save" style="flex:1; font-weight:bold;">
                    <div class="del-btn" @click="removeItem(i)">âœ•</div>
                </div>
            </div>
        </div>

        <div v-if="tab === 'money'">
            <div style="background:#43382F; color:#fff; border-radius:35px; padding:30px 20px; margin:15px; text-align:center;">
                <div style="font-size:11px; opacity:0.6;">TOTAL EXPENSES</div>
                <div style="font-size:36px; font-weight:bold; margin:5px 0;">Â¥ {{ total.toLocaleString() }}</div>
                <div style="color:var(--tea-mid); font-size:14px;">NT$ {{ Math.round(total * 0.21).toLocaleString() }}</div>
                <div style="width: 140px; margin: 15px auto 0;"><canvas id="expenseChart"></canvas></div>
            </div>
            <div class="card">
                <div style="display:flex; gap:8px;">
                    <select v-model="formExp.cat" style="flex:1;"><option v-for="c in categories" :value="c.n">{{c.i}} {{c.n}}</option></select>
                    <input v-model.number="formExp.amt" type="number" placeholder="æ—¥å¹£é‡‘é¡" style="flex:1;">
                </div>
                <input v-model="formExp.note" placeholder="å…§å®¹å‚™è¨»">
                <button class="btn" @click="addExp" style="background:#43382F;">ç´€éŒ„æ”¯å‡º ğŸª™</button>
            </div>
            <div v-for="(e, i) in exps" :key="i" class="card" style="display:flex; align-items:center; padding:15px;">
                <div style="flex:1;">
                    <div style="font-size:10px; color:var(--tea-dark); font-weight:bold;">{{ e.cat }}</div>
                    <input class="edit-input" v-model="e.note" @change="save" style="font-weight:bold;">
                    <div style="color:#888; font-size:13px;">Â¥ <input class="edit-input" type="number" v-model.number="e.amt" @change="save" style="display:inline; width:100px;"></div>
                </div>
                <div class="del-btn" @click="removeExp(i)">âœ•</div>
            </div>
        </div>

        <div class="nav-container">
            <nav class="nav">
                <button class="nav-btn" :class="{active: tab==='trip'}" @click="tab='trip'"><span class="nav-icon">ğŸ—“ï¸</span>è¡Œç¨‹</button>
                <button class="nav-btn" :class="{active: tab==='book'}" @click="tab='book'"><span class="nav-icon">ğŸ”–</span>é è¨‚</button>
                <button class="nav-btn" :class="{active: tab==='list'}" @click="tab='list'"><span class="nav-icon">ğŸ’</span>è¡Œæ</button>
                <button class="nav-btn" :class="{active: tab==='money'}" @click="tab='money'"><span class="nav-icon">ğŸª™</span>è¨˜å¸³</button>
            </nav>
        </div>
    </div>

    <script>
        const { createApp } = Vue
        createApp({
            data() {
                return {
                    tab: 'trip', day: 1, sub: 't', start: '2026-01-12',
                    mainTitle: localStorage.getItem('hk_title') || 'Honeymoon Hokkaido â„ï¸',
                    dayTitles: JSON.parse(localStorage.getItem('hk_day_titles') || '{}'),
                    formTrip: { title: '', t1: '09:00', note: '', img: null },
                    formBook: { title: '', info: '' },
                    formExp: { amt: null, note: '', cat: 'åƒå–' },
                    newItem: '',
                    categories: [{n:'åƒå–',i:'ğŸ±'},{n:'äº¤é€š',i:'ğŸš„'},{n:'è³¼ç‰©',i:'ğŸ›ï¸'},{n:'æ™¯é»',i:'ğŸ¡'},{n:'å…¶ä»–',i:'âœ¨'}],
                    trips: JSON.parse(localStorage.getItem('hk_final_t') || '[]'),
                    books: JSON.parse(localStorage.getItem('hk_final_b') || '{"t":[],"s":[]}'),
                    list: JSON.parse(localStorage.getItem('hk_final_l') || '[{"text":"è­·ç…§","done":false}]'),
                    exps: JSON.parse(localStorage.getItem('hk_final_m') || '[]'),
                    chart: null
                }
            },
            computed: {
                globalCountdown() { return Math.max(0, Math.ceil((new Date(this.start) - new Date()) / 86400000)); },
                tripProgress() {
                    const elapsed = Math.max(0, Math.min(12, Math.ceil((new Date() - new Date(this.start)) / 86400000)));
                    return Math.round((elapsed / 12) * 100);
                },
                filteredTrips() { return this.trips.filter(t => t.day === this.day).sort((a,b) => (a.order || 0) - (b.order || 0)); },
                total() { return this.exps.reduce((s, e) => s + (e.amt || 0), 0); }
            },
            watch: {
                tab(n) { if(n === 'money') this.$nextTick(() => this.initChart()); },
                exps: { handler() { if(this.tab === 'money') this.initChart(); this.save(); }, deep: true }
            },
            mounted() { this.createSnow(); this.initSortable(); },
            updated() { this.initSortable(); },
            methods: {
                handleUpload(e) {
                    const file = e.target.files[0];
                    if (!file) return;
                    const reader = new FileReader();
                    reader.onload = (ev) => { this.formTrip.img = ev.target.result; };
                    reader.readAsDataURL(file);
                },
                addTrip() {
                    if(!this.formTrip.title) return;
                    this.trips.push({ id: Date.now().toString(), day: this.day, order: this.trips.length, ...this.formTrip });
                    this.save();
                    this.formTrip = { title: '', t1: '09:00', note: '', img: null };
                },
                removeTrip(id) { this.trips = this.trips.filter(t => t.id !== id); this.save(); },
                addBook() { if(!this.formBook.title) return; this.books[this.sub].push({...this.formBook}); this.save(); this.formBook = { title: '', info: '' }; },
                removeBook(i) { this.books[this.sub].splice(i, 1); this.save(); },
                addItem() { if(this.newItem){ this.list.push({text:this.newItem,done:false}); this.save(); this.newItem=''; } },
                removeItem(i) { this.list.splice(i, 1); this.save(); },
                addExp() { if(this.formExp.amt){ this.exps.unshift({...this.formExp}); this.save(); this.formExp.amt=null; this.formExp.note=''; } },
                removeExp(i) { this.exps.splice(i, 1); this.save(); },
                save() {
                    localStorage.setItem('hk_title', this.mainTitle);
                    localStorage.setItem('hk_day_titles', JSON.stringify(this.dayTitles));
                    localStorage.setItem('hk_final_t', JSON.stringify(this.trips));
                    localStorage.setItem('hk_final_b', JSON.stringify(this.books));
                    localStorage.setItem('hk_final_l', JSON.stringify(this.list));
                    localStorage.setItem('hk_final_m', JSON.stringify(this.exps));
                },
                initChart() {
                    const ctx = document.getElementById('expenseChart');
                    if (!ctx) return;
                    const dataObj = {}; this.categories.forEach(c => dataObj[c.n] = 0);
                    this.exps.forEach(e => dataObj[e.cat] += (e.amt || 0));
                    if (this.chart) this.chart.destroy();
                    this.chart = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: Object.keys(dataObj),
                            datasets: [{ data: Object.values(dataObj), backgroundColor: ['#ff8fa3', '#E6D5B8', '#F5EBE0', '#D4A373', '#AAA'], borderWidth: 0 }]
                        },
                        options: { plugins: { legend: { display: false } }, cutout: '80%' }
                    });
                },
                createSnow() {
                    const container = document.getElementById('snow');
                    for(let i=0; i<12; i++) {
                        let s = document.createElement('div');
                        s.className = 'snowflake'; s.innerHTML = 'â„';
                        s.style.left = Math.random() * 100 + 'vw';
                        s.style.animationDuration = (Math.random() * 3 + 4) + 's';
                        s.style.opacity = Math.random();
                        container.appendChild(s);
                    }
                },
                initSortable() {
                    const el = document.getElementById('trip-list');
                    if (!el || this.tab !== 'trip') return;
                    if (this.sortableInstance) this.sortableInstance.destroy();
                    this.sortableInstance = Sortable.create(el, {
                        handle: '.drag-handle', animation: 200,
                        onEnd: () => {
                            const ids = Array.from(el.children).map(c => c.dataset.id);
                            this.trips.forEach(t => { if(t.day === this.day) t.order = ids.indexOf(t.id); });
                            this.save();
                        }
                    });
                }
            }
        }).mount('#app')
    </script>
</body>
</html>
